<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visor Regulatorio + BBVA Perú</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <?!= include('Client/css/styleGeneral.css'); ?>
  <?!= include('Client/css/styleNavbar.css'); ?> 
  <?!= include('Client/css/styleLoginRegister.css'); ?>
  <?!= include('Client/css/styleDashboard.css'); ?>
  <?!= include('Client/css/styleUserManagement.css'); ?>
  <?!= include('Client/css/requirements_module_styles.css'); ?>
  <?!= include('Client/css/stylePlaceholders.css'); ?>
  </head>
<body>
  <div id="app" class="d-flex flex-column">
    
    <app-navbar 
        v-if="$root.loggedInUser"
        :user="$root.loggedInUser"
        :current-view="$root.currentView"
        :is-admin="$root.isAdmin"
        :logo-url="'https://cdn.cookielaw.org/logos/5e23ec7b-56dc-4cdb-a251-d6f3a6f81404/24778923-be72-4a36-9c9e-6b0f9290f25b/8fd25358-65ab-49a6-880f-ccb0d967a376/BBVA_TAGLINE_ESP_RGB_RIGHT_DDB.png'"
        @navigate="$root.switchView"
        @logout="$root.logout"
    ></app-navbar>

    <div v-if="$root.globalAlert.message" 
         :class="['alert', 'alert-' + $root.globalAlert.type, 'global-alert', 'animate__animated', 'animate__fadeInDown']" 
         role="alert">
      {{ $root.globalAlert.message }}
      <button type="button" class="btn-close btn-sm" @click="$root.clearGlobalAlert" aria-label="Close"></button>
    </div>

    <div class="main-content-wrapper flex-grow-1 d-flex flex-column" :class="{ 'logged-in': $root.loggedInUser }">
        <main class="flex-grow-1" :class="{'pt-0': !$root.loggedInUser, 'pt-custom': $root.loggedInUser, 'd-flex align-items-center justify-content-center': !$root.loggedInUser && (currentView === 'login' || currentView === 'register')}">
          <div class="auth-form-container animate__animated animate__fadeInUp" v-if="!$root.loggedInUser && (currentView === 'login' || currentView === 'register')">
            <login-view v-if="currentView === 'login'"></login-view>
            <register-view v-if="currentView === 'register'"></register-view>
          </div>

          <div v-if="$root.loggedInUser" class="app-view-container container-fluid px-md-4 py-3 animate__animated animate__fadeIn">
              <div v-if="currentView === 'dashboard'" class="dashboard-view-content"> <img src="https://www.bbva.pe/content/dam/public-web/peru/images/logos/logo-bbva.png" alt="[Logo BBVA]" class="bbva-logo-dashboard">
                  <h2>Bienvenido al Visor Regulatorio +</h2>
                  <div v-if="$root.loggedInUser" class="mt-3 user-details-card mx-auto">
                    <p><strong>ID Usuario:</strong> <span>{{ $root.loggedInUser.userId }}</span></p>
                    <p><strong>Usuario:</strong> <span>{{ $root.loggedInUser.name }}</span></p>
                    <p><strong>Email:</strong> <span>{{ $root.loggedInUser.email }}</span></p>
                    <p><strong>Rol:</strong> <span :class="$root.loggedInUser.role === $root.USER_ROLES_APP.ADMIN ? 'badge bg-primary-bbva text-white' : 'badge bg-secondary-bbva'">{{ $root.loggedInUser.role }}</span></p>
                    <p><strong>Área:</strong> <span>{{ $root.loggedInUser.area }}</span></p>
                    <p><strong>Unidad:</strong> <span>{{ $root.loggedInUser.unidad }}</span></p>
                    <p v-if="$root.loggedInUser.dosie"><strong>Dosier:</strong> <span>{{ $root.loggedInUser.dosie }}</span></p>
                  </div>
              </div>

              <user-list-view v-if="currentView === 'userManagement' && $root.isAdmin"></user-list-view>
              
              <requirement-list-view v-if="currentView === 'requirements'"></requirement-list-view>
              <requirement-form-view v-if="currentView === 'requirementForm'" :requirement-id-to-edit="$root.requirementIdToEdit"></requirement-form-view>
              
              <div v-if="currentView === 'visits'" class="placeholder-view">
                <i class="bi bi-building placeholder-icon"></i>
                <h3 class="mt-3">Módulo de Visitas</h3>
                <p class="text-muted">Esta sección estará disponible próximamente.</p>
              </div>
              <div v-if="currentView === 'recommendations'" class="placeholder-view">
                <i class="bi bi-lightbulb placeholder-icon"></i>
                <h3 class="mt-3">Módulo de Recomendaciones</h3>
                <p class="text-muted">Esta sección estará disponible próximamente.</p>
              </div>
               <div v-if="currentView === 'profile'" class="placeholder-view">
                <i class="bi bi-person-badge placeholder-icon"></i>
                <h3 class="mt-3">Mi Perfil</h3>
                <p class="text-muted">Esta sección estará disponible próximamente para editar tus datos.</p>
              </div>
          </div>
        </main>
    </div>

    <app-footer v-if="$root.loggedInUser"></app-footer>

    <div v-if="$root.isLoading" class="loading-spinner-overlay">
      <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/vue@3.4.27/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

  <?!= include('Client/js/apiService.js'); ?>
  
  <?!= include('Client/js/components/AppNavbar.vue'); ?>
  <?!= include('Client/js/components/AppFooter.vue'); ?> 
  <?!= include('Client/js/views/Login.vue'); ?>
  <?!= include('Client/js/views/Register.vue'); ?>
  <?!= include('Client/js/views/Users/UserList.vue'); ?>
  
  <?!= include('Client/js/views/Requirements/RequirementList.vue'); ?>
  <?!= include('Client/js/views/Requirements/RequirementForm.vue'); ?>
  <?!= include('Client/js/main.js'); ?>

</body>
</html>
